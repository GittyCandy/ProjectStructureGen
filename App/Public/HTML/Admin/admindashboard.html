<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/imagess/attendeaselogo.png">
  <title>Admin Portal</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="/CSS/Admin/admindashboard.css">
</head>


<body>
   <div class="container">

    <aside>
      <div class="top">
        <h2 class="logo1"> AttendEase </h2>
        <div class="close" id="close_btn">
          <span class="material-symbols-sharp">close</span>
        </div>
      </div>
      <div class="sidebar">
        <a href="/Admin_Dashboard" class="active"><lord-icon src="https://cdn.lordicon.com/cnpvyndp.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Admin Dashboard</h3></a>
        <a href="/Configure" class="nav-link"><lord-icon src="https://cdn.lordicon.com/pflszboa.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Configure</h3></a>
        <a href="/Info_Logs" class="nav-link"><lord-icon src="https://cdn.lordicon.com/lyrrgrsl.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Info Logs</h3></a>
        <a href="/Admin_Management" class="nav-link"><lord-icon src="https://cdn.lordicon.com/kddybgok.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>User Management</h3></a>
        <a href="#" class="nav-link"><lord-icon src="https://cdn.lordicon.com/vspbqszr.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Reports</h3><span class="msg_count">14</span></a>
        <a href="#" class="nav-link"><lord-icon src="https://cdn.lordicon.com/lecprnjb.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Settings</h3></a>
        <a href="/" class="nav-link"><lord-icon src="https://cdn.lordicon.com/nqtddedc.json" colors="primary:#D455E6"class="icon"></lord-icon><h3>Logout</h3></a>
      </div>
    </aside>

      <main>

<div class="cardgreet">
    <div class="greet">
        <div class="expenses">
            <h2 id="greeting">Welcome!</h2>
        </div>
        <div class="icon-container">
            <div class="svg-container">
            <!-- Add an icon here if needed -->
        </div>
        </div>
    </div>
</div>


              <div class="insights">
        <!-- Sales (CPU Usage) -->
        <div class="sales">
            <lord-icon
    src="https://cdn.lordicon.com/jfwzwlls.json"
    trigger="hover"
    colors="primary:#D455E6"
    style="width:65px;height:65px">
</lord-icon>
            <div class="middle">
                <div class="left">
                    <h3>CPU Usage</h3>
                    <h1 id="cpu-usage">0%</h1>
                </div>
                <div class="progress">
                    <svg>
                        <circle id="progress-circle-cpu" r="30" cy="40" cx="40"></circle>
                    </svg>
                    <div class="number">
                        <p id="cpu-percentage">0%</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Expenses (Memory Usage) -->
        <div class="expenses">
            <lord-icon
    src="https://cdn.lordicon.com/jfwzwlls.json"
    trigger="hover"
    colors="primary:#D455E6"
    style="width:65px;height:65px">
</lord-icon>
            <div class="middle">
                <div class="left">
                    <h3>Memory Usage</h3>
                    <h1 id="memory-usage">0%</h1>
                </div>
                <div class="progress">
                    <svg>
                        <circle id="progress-circle-memory" r="30" cy="40" cx="40"></circle>
                    </svg>
                    <div class="number">
                        <p id="memory-percentage">0%</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Income (Disk Usage) -->
        <div class="income">
            <lord-icon
    src="https://cdn.lordicon.com/jfwzwlls.json"
    trigger="hover"
    colors="primary:#D455E6"
    style="width:65px;height:65px">
</lord-icon>
            <div class="middle">
                <div class="left">
                    <h3>Disk Usage</h3>
                    <h1 id="disk-usage">0%</h1>
                </div>
                <div class="progress">
                    <svg>
                        <circle id="progress-circle-disk" r="30" cy="40" cx="40"></circle>
                    </svg>
                    <div class="number">
                        <p id="disk-percentage">0%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="graph_container">
        <h2>Analytics</h2>
        <canvas id="attendanceChart" width="400" height="200"></canvas>
    </div>

      </main>

    <div class="right">

<div class="top">
   <button id="menu_bar">
     <span class="material-symbols-sharp">menu</span>
   </button>


<div class="theme-toggler">
  <label class="switch">
    <!-- Using the same id ("input") so that your existing JS continues to work -->
    <input id="input" type="checkbox" />
    <div class="slider round">
      <div class="sun-moon">
        <!-- Moon dots and light rays (SVGs for the animated sun/moon) -->
        <svg id="moon-dot-1" class="moon-dot" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="moon-dot-2" class="moon-dot" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="moon-dot-3" class="moon-dot" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="light-ray-1" class="light-ray" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="light-ray-2" class="light-ray" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="light-ray-3" class="light-ray" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <!-- Clouds (two types to allow color variations) -->
        <svg id="cloud-1" class="cloud-dark" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="cloud-2" class="cloud-dark" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="cloud-3" class="cloud-dark" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="cloud-4" class="cloud-light" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="cloud-5" class="cloud-light" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
        <svg id="cloud-6" class="cloud-light" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="50"></circle>
        </svg>
      </div>
      <div class="stars">
        <svg id="star-1" class="star" viewBox="0 0 20 20">
          <path d="M 0 10 C 10 10,10 10, 0 10 C 10 10, 10 10, 10 20 C 10 10, 10 10, 20 10 C 10 10, 10 10, 10 0 C 10 10,10 10, 0 10 Z"></path>
        </svg>
        <svg id="star-2" class="star" viewBox="0 0 20 20">
          <path d="M 0 10 C 10 10,10 10, 0 10 C 10 10, 10 10, 10 20 C 10 10, 10 10, 20 10 C 10 10, 10 10, 10 0 C 10 10,10 10, 0 10 Z"></path>
        </svg>
        <svg id="star-3" class="star" viewBox="0 0 20 20">
          <path d="M 0 10 C 10 10,10 10, 0 10 C 10 10, 10 10, 10 20 C 10 10, 10 10, 20 10 C 10 10, 10 10, 10 0 C 10 10,10 10, 0 10 Z"></path>
        </svg>
        <svg id="star-4" class="star" viewBox="0 0 20 20">
          <path d="M 0 10 C 10 10,10 10, 0 10 C 10 10, 10 10, 10 20 C 10 10, 10 10, 20 10 C 10 10, 10 10, 10 0 C 10 10,10 10, 0 10 Z"></path>
        </svg>
      </div>
    </div>
  </label>
</div>


    <div class="profile">
       <div class="info">
           <b><p id="name"></p></b>
           <p id="role"></p>
           <small class="text-muted"></small>
       </div>
       <!--<div class="profile-photo">
         <img src="./images/profile-1.jpg" alt=""/>
       </div>-->
    </div>
</div>

<div class="sales-analytics">
  <center><h2>Capture Faces</h2></center>
  <div class="card face-upload">
    <div class="card-header">
      <h3>Upload Face Data</h3>
      <p>Image format Name_ID</p>
      <p>("John Doe_7821821")</p>
    </div>
    <div class="card-body">
    <form id="">
        <div  id="startButton"></div>
        <div id="stopButton" disabled></div>
    </form>
      <label for="faceFolder" class="drop-zone" id="dropZone">

<lord-icon
    src="https://cdn.lordicon.com/jkzgajyr.json"
    trigger="hover"
    colors="primary:#D455E6"
    style="width:50px;height:50px">
</lord-icon>
        <p>Drag & drop a folder here or <span class="upload-text">click to upload</span></p>
      </label>
      <input type="file" id="faceFolder" webkitdirectory directory multiple hidden required>
      <button type="submit" id="uploadButton">
        <span class="material-symbols-sharp">cloud_upload</span> Upload & Train AI
      </button>
      <!-- Separate text area for image count -->
      <div id="imageCountDisplay"></div>
      <!-- Scrollable progress container -->
      <div id="progressContainer">
        <p id="uploadStatus"></p>
      </div>
    </div>
  </div>
</div>




</div>

</div>


   <script>document.addEventListener("DOMContentLoaded", () => {
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("faceFolder");
  const uploadButton = document.getElementById("uploadButton");
  const progressArea = document.getElementById("uploadStatus");
  const imageCountDisplay = document.getElementById("imageCountDisplay");

  // Drag and drop functionality
  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("dragover");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });

  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("dragover");

    const items = e.dataTransfer.items;
    const fileList = new DataTransfer(); // Create a new file list

    // Process each item (file or folder)
    const processEntry = (entry) => {
      return new Promise((resolve) => {
        if (entry.isFile) {
          entry.file((file) => {
            fileList.items.add(file); // Add the file to the list
            resolve();
          });
        } else if (entry.isDirectory) {
          const reader = entry.createReader();
          reader.readEntries((entries) => {
            const entryPromises = entries.map(processEntry);
            Promise.all(entryPromises).then(resolve);
          });
        }
      });
    };

    // Process all items
    const processAllEntries = async () => {
      for (let i = 0; i < items.length; i++) {
        const entry = items[i].webkitGetAsEntry();
        if (entry) {
          await processEntry(entry);
        }
      }
      fileInput.files = fileList.files; // Update the file input with the new file list
      updateImageCount(); // Update the image count display
    };

    processAllEntries();
  });

  // Click to open file dialog
  dropZone.addEventListener("click", () => fileInput.click());

  // Update image count when files are selected via file input
  fileInput.addEventListener("change", () => {
    updateImageCount(); // Show the number of images selected
  });

  // Function to update the number of images
  function updateImageCount() {
    const files = fileInput.files;
    if (files.length > 0) {
      imageCountDisplay.innerText = `${files.length} image(s) ready for upload.`;
    } else {
      imageCountDisplay.innerText = "No images selected.";
    }
  }

  // Upload and train functionality
  uploadButton.addEventListener("click", async () => {
    const files = fileInput.files;
    if (!files.length) return;

    uploadButton.classList.add("processing");
    progressArea.innerText = "Uploading and processing...";

    const formData = new FormData();
    for (const file of files) {
      formData.append("faces", file);
    }

    try {
      const response = await fetch("/upload", {
        method: "POST",
        body: formData,
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder();

      const processStream = ({ done, value }) => {
        if (done) {
          uploadButton.classList.remove("processing");
          deleteUploadedFiles(files); // Delete uploaded files after processing
          progressArea.innerHTML += `<div class="resultItem">Processing complete. Images deleted.</div>`;
          return;
        }

        const text = decoder.decode(value);
        const lines = text.split("\n\n");
        lines.forEach((line) => {
          if (line.startsWith("data: ")) {
            const message = line.replace("data: ", "");
            const [name, status] = message.split("||");
            progressArea.innerHTML += `<div class="resultItem">${name}: ${status}</div>`;
            progressArea.scrollTop = progressArea.scrollHeight;
          }
        });

        reader.read().then(processStream);
      };

      reader.read().then(processStream);
    } catch (error) {
      console.error("Upload failed:", error);
      progressArea.innerText += "Upload failed.\n";
      uploadButton.classList.remove("processing");
    }
  });

  // Function to delete uploaded files after processing
  function deleteUploadedFiles(files) {
    for (const file of files) {
      const filePath = URL.createObjectURL(file);
      URL.revokeObjectURL(filePath); // Release the object URL
      console.log(`Deleted: ${file.name}`);
    }
    fileInput.value = ""; // Clear the file input
    updateImageCount(); // Reset the image count display
  }
});
   </script>

<script src="https://cdn.jsdelivr.net/npm/raphael/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage/justgage.min.js"></script>
<script src="https://cdn.lordicon.com/lordicon.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="/JavaScript/Admin/admindashboard.js"></script>
</body>
</html>